## 三、ICA信号分离

1. 将三幅图像混合在一起，得到三幅混合后的图像，分别采用三种不同的ICA方法进行图像恢复，并讨论分析。
2. 将三幅图像混合在一起，得到四幅混合后的图像，分别采用三种不同的ICA方法进行图像恢复，并与题一得到的结果进行比较
3. 将三个语音信号进混合在一起，得到三个混合后的语音信号，分别采用三种不同的ICA方法进行信号恢复，并讨论分析。
4. 将三个语音信号进混合在一起，得到四个混合后的语音信号，分别采用三种不同的ICA方法进行信号恢复，并与题三得到的结果进行比较。

由于上述四题都为ICA分离信号的问题，因此将它们合并在一起报告。

### 1. 基础知识

对于混合的信号，如果各信号独立，且如果在众多信号中，最多有一个分布为高斯分布的数据信号，我们可以使用独立元分析的方法将原信号进行解混。解混的思路就是使用各种方法（如统计特性、神经网络的负反馈等）使输出数据的独立性达到最大，此时就可以恢复出混合之前的信号，但是，恢复后的信号，在幅度和顺序上是随机的。

ICA主要分为两类方法：非目标函数和有目标函数的，分类主要如下

| 非目标函数   | 有目标函数   |
| ------- | ------- |
| H-J方法   | 最大熵法    |
| 四阶统计量方法 | 最小互信息法  |
| -       | 负熵法     |
| -       | FastICA |

然后，本次使用的方法为H-J方法、四阶统计量方法、最大熵法和FastICA法。

#### 1.1 H-J方法

H-J方法的核心是利用独立的定理：当$x$与$y$独立时，$E(f(x)g(y))=E(f(x))E(g(y))$，$f,g$为任意的函数。

其主要流程如下：

![H-J](E:\17年学习\神经网络\神经网络作业二\NN_second_homework\ICA\报告用图\H-J.png)

$s_i$为源信号，$\mathbf{A}$为混合矩阵，$x_i$为混合后的信号，$\mathbf{W}$是$x_i$混合混阵，$y_i$是混合以后得到的值。它们的关系是：
$$
\mathbf{y}=\mathbf{x}-\mathbf{Wy}\\
\mathbf{x}=(I+\mathbf{W})\mathbf{y}\\
\mathbf{y}=(I+\mathbf{W})^{-1}\mathbf{x}
$$
权值的调整公式为：
$$
\frac{d\mathbf{w}}{dt}=\eta\mathbf{f(y)g(y)}\\
or\\
\frac{d\mathbf{w}}{dt}=\eta(I-\mathbf{f(y)g(y)})
$$
当$f(\cdot),g(\cdot)$为奇函数，当$\mathbf{y}$内部的各变量互相独立时，有$\frac{d\mathbf{w}}{dt}=0$。

其方法的步骤为：

1. 初始化权值$
2. 算出$\frac{d\mathbf{w}}{dt}$
3. 调整权值直到$\mathbf{w}$不变。
4. 得到分离后的信号$\mathbf{y}$

#### 1.2 白化

由于后面的方法都会用到白化处理，因此在这里先介绍一下什么是白化。

白化本质上是一个单位方差的PCA处理。

将每一路信号表示为$\mathbf{x}_i,i=1,2,\ldots,m$，$m$为观察到的信号的数量，源表示为$\mathbf{s}_i,i=1,2,\ldots,n$，则对$\mathbf{x}_i$的集合作协方差得到协方差矩阵$\mathbf{C}_x$，它的特征值按从大到小排序为$\lambda_1,\lambda_2,\ldots,\lambda_m$，对应的特征向量为$\mathbf{u}_1,\mathbf{u}_2,\ldots,\mathbf{u}_m$。对协方差矩阵进行SVD分解：
$$
\mathbf{C}_x=[\mathbf{u}_1,\mathbf{u}_2,\ldots,\mathbf{u}_m]diag(\lambda_1,\ldots,\lambda_m)[\mathbf{u}_1,\mathbf{u}_2,\ldots,\mathbf{u}_m]^T
$$
若$s_i$互相都是独立的，则所有特征值中，前n个特征值非零，若样本是无噪的，则后$m-n$个特征值为0，若有噪声，其方差为$\delta^2$，则后$m-n$个特征值为$\delta^2$。

那么由此就可从混合信号中观察到源信号的个数。

所以定义白化矩阵：
$$
\mathbf{M}=diag(\frac{1}{\sqrt{\lambda_1}},\frac{1}{\sqrt{\lambda_2}},\ldots,\frac{1}{\sqrt{\lambda_n}})[\mathbf{u}_1,\mathbf{u}_2,\ldots,\mathbf{u}_n]^T
$$
则白化过程即是混合后的信号左乘白化矩阵：
$$
\mathbf{z}=\mathbf{M}\mathbf{x}
$$
$\mathbf{z}$是白化后的信号。所以当源的数量与观察信号数量不一致，但方法要求他们一致时可以先白化再处理。

整个算法流程可以表示如下：

1. 将观察到的信号向量移除均值。


2. 求取协方差矩阵的特征值，并确定源的个数
3. 求取白化矩阵并白化观察信号，得到$\mathbf{z}$

由于实际过程中，样本总是带噪声的，因此对于白化过程的噪声方差要由先验知识进行调整。

#### 1.3 四阶统计量方法

该方法同样是无目标函数的ICA算法。其核心证明过程即是用四阶矩可以得到如下关系：
$$
\mathbf{A}=\mathbf{M}^{-1}\mathbf{B}   \\
\mathbf{s}=\mathbf{B}^T\mathbf{z}\\
$$
其中，$\mathbf{B}$为白化后信号$\mathbf{z}$的四阶矩的特征向量组成的矩阵 ，可由SVD分解得到。

流程为：

1. 先将观察的信号白化
2. 求白化后信号的四阶矩，进行SVD分解，得到特征向量组成的矩阵B。
3. 源信号即是$\mathbf{s}=\mathbf{B}^T\mathbf{x}$

#### 1.4 最大熵方法

这是一个有目标函数的ICA算法，利用信号独立时，信息熵最大这一性质，定义：
$$
y_i = f(u_i)\\
f(u_i)=\frac{1}{1+e ^{-u_i}}\\
u_i = \sum_{j=1}^mw_{i,j}x_j
$$
则向量$\mathbf{y}$的熵定义为：
$$
H(\mathbf{y})=-\int P_y(\mathbf{y})\log P_y(\mathbf{y})d\mathbf{y} = -E(\log P_y(\mathbf{y}))
$$
$P_y(\mathbf{y})$为概率密度函数。

则权值的调整公式即为：
$$
\Delta \mathbf{W}=\eta \frac{\partial H(\mathbf{y})}{\partial \mathbf{W}}=\eta((\mathbf{W}^T)^{-1}+(\mathbf{1}-2\mathbf{y}))
$$
$\mathbf{1}$为全1的向量。

其步骤为：

1. 初始化权值，随机选取$\mathbf{W}$
2. 算出$\mathbf{y}$。
3. 算出$\Delta \mathbf{W}$
4. 迭代直到$\Delta\mathbf{W}$不再变化。

#### 1.5 FASTICA方法

FastICA是有目标函数的ICA算法.

考虑单一神经元，令$\mathbf{x}$为白化后的零均值向量$\mathbf{z}$的样本，输入到该神经元。我们制定的基本学习规则为：“在神经元权值$\mathbf{w}$取$\Vert\mathbf{w}\Vert=1$的约束下，最大化$\mathbf{w}$对随机向量$\mathbf{z}$投影的负熵“，在该原则下，其目标函数是：
$$
F =E\{G_2(\mathbf{w}^T\mathbf{z})\}+\frac{1}{2}\beta\Vert \mathbf{w} \Vert
$$
权值调整公式为：
$$
\mathbf{w}_i(t)=E\{g_2(\mathbf{w}_i^T(t-1)\mathbf{z})\mathbf{z}  \}-E\{ g_2(\mathbf{w}_i^T(t-1)\mathbf{z}) \}\mathbf{w}_i(t-1)
$$
$G_2(\cdot)$是偶函数，一般取：


$$
G_2(y)=\frac{1}{a}\log(\cosh(ay)),a\in[1,2]\\
or\\
G_2(y)=-\exp(-\frac{y^2}{2})
\\
g_2(y)=\frac{\partial G_2(y)}{\partial y}\\
g_2(y)=a(1-\tanh^2(ay)),a\in[1,2]\\
g_2(y)=(1-y^2)\exp(-\frac{y^2}{2})
$$


其步骤为：

1. 对样本进行白化
2. 随机初始化神经元权值$\mathbf{w}_i(0)$并归一化
3. 计算$g_2(y)$并根据上述公式得到下一步的$\mathbf{w_i}(t)$并归一化
4. 正交化$\mathbf{w}_i(t)$
5. 如果$\mathbf{w}_i$不收敛，回到3。

### 2. 仿真方法

#### 2.1 分布分析

采用以上四种方法对图像的混合以及音频的混合结果进行解混。由于ICA要求只能有一个高斯分布，因此，先对信号进行四阶累积量分析：

| 图像   | 1        | 2         | 3        | 4         |
| ---- | -------- | --------- | -------- | --------- |
| kurt | 9.47e+06 | -9.34e+06 | 1.40e+06 | -4.33e+06 |

则图像信号为两个超高斯，两个亚高斯分布

![1](E:\17年学习\神经网络\神经网络作业二\NN_second_homework\ICA\风景图\1.bmp)

![2](E:\17年学习\神经网络\神经网络作业二\NN_second_homework\ICA\风景图\2.bmp)

![3](E:\17年学习\神经网络\神经网络作业二\NN_second_homework\ICA\风景图\3.bmp)

![4](E:\17年学习\神经网络\神经网络作业二\NN_second_homework\ICA\风景图\4.bmp)

声音信号的四阶累计量普遍较小，可能和声音信号读取的时候进行了归一化有关，我们一般认为声音信号属于超高斯信号。

#### 2.2 解混的评价标准

对于图片，我们可以用之前用过的PSNR作为判断依据，同时，比较两个序列的相近程度，我们可以用皮尔逊相关系数来进行评价：
$$
r(X,Y)=\frac{Cov(X,Y)}{\sqrt{Var(X)Var(Y)}}
$$
$Cov(\cdot)$是协方差，$Var(\cdot)$是方差。

当$r$越靠近1，则两者相关程度越大，信号也越相近。

因此用PSNR和相关系数作为评价标准。

#### 2.3 源信号的选取

本次仿真对于图片混合是从四张图中**随机选取三张图片**进行混合。对于音频信号，由于经过实验，不同种类的音频信号，长度与采样率都不同，混合时可能会出现问题，为了实验便利性考虑，**只使用同一类的音频**进行混合（实际实验中只使用了music类型的音频）。混合矩阵是随机产生并归一化过的。



###3.信号分离效果：

#### 3.1 问题1的结果（3幅混3幅）





